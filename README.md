# DUAL
DUAL-NET Learning process

3.18-3.24
在Dijkstra code添加了
1.基于Occupancy_map的实时占位图显示：每次绘制出仿真模拟边界，然后遍历世界中的所有actor，如果是car，就使用get_vehicle_bounding_box_corners函数获取其边界框顶点,并使用matplotlib的plot函数绘制边界框。

2.添加了动态dijkstra的路径规划算法：
  首先车辆的生成点都需要随机选择在仿真模拟边界与道路网络的交界处（右车道），车辆的终点随机选择在仿真模拟边界与道路网络的交界处（左车道），车辆的路径选择依赖动态权值；权值的设定是安全权值*方向权值*优先级权值，其中安全权值的定义为：在车辆下一个可能的所有路径点中，如果该路径点范围内有其他车辆（依赖与原有的碰撞检测）则值为0.1，如果路径点是其他车辆的可选路径点时值为0.5，如果都不是则值为0.9；方向权值的定义为：分别计算当前位置与终点的方向角和下一个可能路径点与终点的方向角，两者差的cos值来表示下一个方向与终点的接近程度。优先级权值的定义为：根据车辆当前位置与下一个位置之间的角度，判断出直行左转还是右转，直行权值为0.8，左转为0.6，右转为0.4。每次车辆在选择下一位置时候都根据权值来选择，直到车辆到达终点。
  
  具体的实现中，为了满足可以向前搜索至终点，引入一个内部函数DFS（深度优先搜索）从当前位置沿着所有可能的路径向前搜索，直到终点。对于每个可能的下一个路径点,计算其安全权值、方向权值和优先级权值,就像之前一样。然后,将这些权值相乘得到下一个路径点的总权值。递归地调用dfs,将当前路径点、当前路径和当前总权值作为参数。每当到达终点时,将当前路径和总权值作为一个元组添加到paths列表中。在搜索完所有可能的路径后,从paths列表中选择总权值最大的路径,并将其设置为车辆的新路径。如果没有找到有效的路径(例如,所有可能的路径都会导致碰撞),将车辆的路径设置为只包含当前位置的路径,实际上使车辆停止移动。这个修改后的算法确保了车辆在每个位置都会选择一条从当前位置到终点的最优路径。车辆会沿着这条路径移动到下一个位置,然后重新运行算法,找到从新位置到终点的最优路径。这个过程会一直重复,直到车辆到达终点。

3.为解决余有车辆未完成规划的现象
  引入了一个新的变量spawn_car来控制是否生成新的车辆。当车辆数量达到num_car时,将spawn_car设置为False,停止生成新车辆。还添加了一个检查,销毁已经离开仿真区域的车辆。如果一辆车不再位于仿真区域内,将其ID添加到destroy_list中。最后,添加了一个停止条件。如果不再生成新车辆,并且所有现有车辆都已离开仿真区域,就退出主循环,停止仿真。

4.关于出生点和终点的选择规则
  原代码中的出生点随机生成，并且终点的选择是随机选择一条路径来确定。算法要改进的是出生点和终点的选择规则。具体：关于出生点的选择，根据交通规则，车辆应在右车道行驶，从左车道驶入。读取sumo网络文件，分析edge的属性，lane的标签值如果/2 ==0，说明是属于左车道，则用来做终点的选择，如果标签纸/2 == 1，说明是右车道，用来做出生点的选择。选择规则基于仿真模拟边界与sumo道路网络交界的坐标来判定。
  
